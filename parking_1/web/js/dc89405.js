"use strict";function DT(tableSelector,options){if(!this||this===window){return new DT(tableSelector,options)}else{this.table=$(tableSelector);this.options=$.extend({},this.options,options||{});this.init()}}DT.prototype={options:{responsive:false,searchDelay:500,processing:true,serverSide:true,pagingType:"full_numbers",reorderColumn:false},table:null,searchForm:null,exportButtons:null,api:null,headerReorderSaveButton:null,reorderOldCreatedRowCallback:undefined,init:function(){var that=this,temp=$.extend({},this.options);if(this.table.data("search-form-selector")){this.searchForm=$(this.table.data("search-form-selector"))}if(this.options.searchFields){temp.initComplete=function(){that.api=that.api||this.api();that.searchFieldsInitCompleteWrapper();if(that.options.initComplete){that.options.initComplete.apply(this,arguments)}}}if(!!this.options.reorderColumn){this.reorderOldCreatedRowCallback=temp.createdRow;temp.createdRow=function(row,data,index){$("td."+that.options.reorderColumn.className,row).prepend('<i class="la la-arrows-v"></i>');if(that.reorderOldCreatedRowCallback){that.reorderOldCreatedRowCallback.apply(this,arguments)}};temp.rowReorder={selector:"."+this.options.reorderColumn.className+" > i.la",update:false}}delete temp.reorderColumn;this.api=this.table.DataTable(temp);this.prepareExportButtons();this.prepareSearchFormControls();this.prepareReorderControls()},prepareExportButtons:function(){var that=this;this.exportButtons=this.table.parents(".k-portlet:first").find("a[data-table-export]").attr("data-table",this.table.attr("id")).unbind("click").click((function(){var url=that.api.ajax.url(),params=$.extend({},that.api.ajax.params()||that.api.draw().ajax.params(),{_:Date.now()});params.export="csv";url+=url.indexOf("?")==-1?"?":url[url.length-1]=="?"||url[url.length-1]=="&"?"":"&";url+=that.toURL(params);window.location=url;return false}))},prepareSearchFormControls:function(){if(!this.searchForm){return}var that=this;this.searchForm.on("click","button",(function(){if($(this).is("#reset")){that.searchForm.trigger("reset").find("input, select, textarea").val("").change()}that.searchForm.serializeArray().map((function(param){that.changeAJAXParemeter(param.name,param.value,false,false)}));that.reload()}))},searchFormApply:function(){this.searchForm.find("button[name*=apply]:first").click()},searchFormReset:function(){this.searchForm.trigger("reset").find("input, select, textarea").val("").change();this.searchFormApply()},prepareReorderControls:function(){if(!this.options.reorderColumn){return}var that=this;this.bind("row-reorder",(function(event,diff,edit){if(diff.length>1){var data={},i=0,temp;for(;i<diff.length;i++){temp=that.api.row(diff[i].node).data();data["data["+i+"][id]"]=temp.id;data["data["+i+"][order]"]=temp[that.options.reorderColumn.field]}temp=data["data[0][order]"];for(i=1;i<diff.length;i++){data["data["+(i-1)+"][order]"]=data["data["+i+"][order]"]}data["data["+(i-1)+"][order]"]=temp;sendQeury(that.options.reorderColumn.url,data).done((function(){that.reload()}))}}));this.table.on("click","td.reorder",(function(){that.table.find("td.reorder i").remove();that.api.rowReorder.disable();if(!that.headerReorderSaveButton){that.headerReorderSaveButton=$('<a class="btn mar k-margin-l-5 reordeBasenoms btn-sm btn-elevate btn-brand saveOrder" title="Save order"><span></span></a>');that.table.find("th."+that.options.reorderColumn.className).append(that.headerReorderSaveButton);that.headerReorderSaveButton.click((function(){var data={};that.table.find(".orderNumber").each((function(i){data["data["+i+"][id]"]=$(this).data("id");data["data["+i+"][order]"]=parseInt(this.value)}));sendQeury(that.options.reorderColumn.url,data).done((function(){that.reload();that.headerReorderSaveButton.remove();that.headerReorderSaveButton=null;that.api.rowReorder.enable()}))}))}if($(".orderNumber",this).length==0){var tmp=that.api.row(this.parentNode).data();$('<span> => <input type="number" class="orderNumber" min="0" max="100000" data-id="'+tmp.id+'" value="'+tmp.order+'"></span>').appendTo(this).find("input").focus()}}))},changeAJAXParemeter:function(parameter,value,instantReload,onlyReturnAddress){var url=this.api.ajax.url();url+=url.indexOf("?")==-1?"?":url[url.length-1]=="?"||url[url.length-1]=="&"?"":"&";url=url.replace(new RegExp("([&?])"+encodeURIComponent(parameter)+"=[^&$]*&?","i"),"$1");url+=encodeURIComponent(parameter)+"="+encodeURIComponent(value);if(instantReload){this.api.ajax.url(url);this.reload()}else if(!onlyReturnAddress){this.api.ajax.url(url)}return url},reload:function(){this.api.ajax.reload()},bind:function(event,callback){this.api.on(event,callback);return this},unbind:function(event,callback){this.api.off(event,callback);return this},one:function(event,callback){this.api.one(event,callback);return this},searchFieldsInitCompleteWrapper:function(){var that=this,filtersRow=$('<tr class="filter"></tr>').appendTo(this.table.find("thead")),searchFields=this.options.searchFields;if(this&&this.api&&this.api.columns){this.api.columns().every((function(colIndex,e){if(!that.api.column(colIndex).visible()){return}var column=searchFields[colIndex]||{},input="&nbsp;";switch(column["type"]){case"input":input=$('<input type="search" class="form-control form-control-sm form-filter k-input" data-col-index="'+colIndex+'"/>');break;case"select":input=$('<select class="form-control form-control-sm form-filter k-input" title="Select" data-col-index="'+colIndex+'"><option value="">Select</option></select>');if(column["value"]!=null){$.each(column["value"],(function(val,txt){input.append('<option value="'+val+'">'+txt+"</option>")}))}break;case"date":input=$('<input type="text" readonly="readonly" id="date_'+colIndex+'" class="form-control form-control-sm form-filter k-input datepick" title="Date" placeholder="Select date" data-col-index="'+colIndex+'" />');input.datepicker({format:"dd.mm.yyyy",autoclose:true,todayBtn:"linked",clearBtn:true,enableOnReadonly:true});break;case"date_range":input=$('<input  class="form-control form-control-sm form-filter datepick k-input" data-col-index="'+colIndex+'"  readonly="readonly"  placeholder="Select date" type="text"/>');input.daterangepicker({autoUpdateInput:false,locale:{cancelLabel:"Clear"},opens:["right","center","left","left"][Math.floor((colIndex+1)/searchFields.length*3)]}).on("apply.daterangepicker",(function(ev,picker){var col=that.api.columns($(this).data("col-index"));this.value=picker.startDate.format("DD.MM.YYYY")+" - "+picker.endDate.format("DD.MM.YYYY");if(col.search()!==this.value){col.search(this.value).draw()}})).on("cancel.daterangepicker",(function(ev,picker){var col=that.api.columns($(this).data("col-index"));this.value="";if(col.search()!==this.value){col.search(this.value).draw()}}));break}filtersRow.append($("<th>").append(input))}))}filtersRow.find(".k-input").bind("change keyup",(function(){var column=that.api.columns($(this).data("col-index"));if(column.search()!==this.value){column.search(this.value).draw()}}))},toURL:function(obj,prefix){var output=[],key,k,v;for(key in obj){if(obj.hasOwnProperty(key)){k=prefix?prefix+"["+key+"]":key;v=obj[key];if(v!==null&&typeof v==="object"){output[output.length]=this.toURL(v,k)}else{output[output.length]=encodeURIComponent(k)+"="+encodeURIComponent(v)}}}return output.join("&")}};function DatatablesDataSourceAjaxServer(tableId,opts){var table=$("#id_"+tableId);var dtOpts={};if("searchFields"in opts){dtOpts["initComplete"]=function(){if(arguments.length==1){var oThis=arguments[0]}else var oThis=this;var rowFilter=$('<tr class="filter"></tr>').appendTo($("#id_"+tableId+" thead"));var searchFields=opts.searchFields;var input;oThis.api().columns().every((function(i,e){if(searchFields[i]){var column=searchFields[i];if(column["type"]==null){input=""}if(column["type"]=="input"){input=$('<input type="search" class="form-control form-control-sm form-filter k-input" data-col-index="'+i+'"/>')}if(column["type"]=="select"){input=$('<select class="form-control form-control-sm form-filter k-input" title="Select" data-col-index="'+i+'"><option value="">Select</option></select>');if(column["value"]!=null){$.each(column["value"],(function(d,j){$(input).append('<option value="'+d+'">'+j+"</option>")}))}}if(column["type"]=="date"){input=$('<input type="text" readonly="readonly" id="date_'+i+'" class="form-control form-control-sm form-filter k-input datepick" title="Date" placeholder="Select date" data-col-index="'+i+'" />');$(input).datepicker({format:"dd.mm.yyyy",autoclose:true,todayBtn:"linked",clearBtn:true,enableOnReadonly:true})}if(column["type"]=="date_range"){input=$('<input  class="form-control form-filter datepick k-input" data-col-index="'+i+'"  readonly="readonly"  placeholder="Select date" type="text"/>');$(input).daterangepicker({autoUpdateInput:false,locale:{cancelLabel:"Clear"},opens:"left"});$(input).on("apply.daterangepicker",(function(ev,picker){$(this).val(picker.startDate.format("DD.MM.YYYY")+" - "+picker.endDate.format("DD.MM.YYYY"));var t=$(table).DataTable();var that=t.columns($(this).data("col-index"));if(that.search()!==this.value){that.search(this.value).draw()}}));$(input).on("cancel.daterangepicker",(function(ev,picker){$(this).val("");var t=$(table).DataTable();var that=t.columns($(this).data("col-index"));if(that.search()!==this.value){that.search(this.value).draw()}}))}}else{input=""}$(input).appendTo($("<th>").appendTo(rowFilter))}))}}var defaultOpts={responsive:true,searchDelay:500,processing:true,serverSide:true,pagingType:"full_numbers"};for(var okey in defaultOpts){if(okey in opts){dtOpts[okey]=opts[okey]}else{dtOpts[okey]=defaultOpts[okey]}}if("removeSearching"in opts){dtOpts["searching"]=false}if("order"in opts){dtOpts["order"]=opts["order"]}if("dom"in opts){dtOpts["dom"]=opts["dom"]}if("ajaxUrl"in opts)dtOpts["ajax"]=opts["ajaxUrl"];if("ajax"in opts)dtOpts["ajax"]=opts["ajax"];dtOpts["columns"]=opts["columns"];dtOpts["columnDefs"]=opts["columnDefs"];if("fnRowCallback"in opts)dtOpts["fnRowCallback"]=opts["fnRowCallback"];if("initComplete"in opts){if("initComplete"in dtOpts){var old_init=dtOpts["initComplete"];dtOpts["initComplete"]=function(){old_init(this);var cinit=opts["initComplete"];cinit(this)}}else{dtOpts["initComplete"]=opts["initComplete"]}}if("scrollY"in opts){dtOpts["scrollY"]=opts["scrollY"]}if("scrollCollapse"in opts){dtOpts["scrollCollapse"]=opts["scrollCollapse"]}if("paging"in opts){dtOpts["paging"]=opts["paging"]}if("lengthMenu"in opts){dtOpts["lengthMenu"]=opts["lengthMenu"]}if("rowReorder"in opts){dtOpts["rowReorder"]=opts["rowReorder"]}if(opts.callbacks!==undefined){for(var i in opts.callbacks){dtOpts[i]=opts.callbacks[i]}}table.DataTable(dtOpts);if("searchFields"in opts){filters("#id_"+tableId)}}function filters(table){var table=$(table).DataTable();$(document).on("change keyup",".k-input",(function(){var that=table.columns($(this).data("col-index"));if(that.search()!==this.value){that.search(this.value).draw()}}))}function gridApiCustomParam(grid,param,val,reload){var url=grid.dataTable().api().ajax.url();var sep="&";var sstr=param+"=";if(url.indexOf("?")<0)sep="?";if(url.indexOf(param+"=")<0)url=url+sep+sstr+val;else{var replaceStr=new RegExp("("+param+")=([\\w])(&{0,1})");url=url.replace(replaceStr,"$1="+val+"$3")}if(reload){grid.dataTable().api().ajax.url(url);grid.dataTable().api().ajax.reload()}return url}$("a[data-table-export]").click((function(){var $this=$(this),$table=false,api=false,params={},url;$this.parents().each((function(){var tmp=$(this).find("table.dataTable[id]");if(tmp.length==1&&tmp.dataTable().api()){$table=tmp;api=tmp.dataTable().api();return false}}));if(api){url=api.ajax.url().split("?");if(url[1]){url[1].replace(/([^=]+)=([^&]+)(&|$)/g,(function(found,key,val){params[decodeURIComponent(key)]=decodeURIComponent(val)}))}params.export=$this.data("table-export");params=$.extend(params,api.ajax.params());$table.trigger("export.prepare",params);window.location=url[0]+"?"+$.param(params)}else if(window.lastFlightSearch){window.location=window.lastFlightSearch+"&export="+$this.data("table-export")}return false}));
function autocomplete(element){var base=siteUrl;$("#"+element).keyup((function(e){var el=$(this);var symbmin=el.attr("automin")||2;$(".lists").remove();if(el.val().length>=symbmin){$.ajax({method:"post",url:urls.basenom_get_list,data:{data:{val:el.val(),type:el.data("type")}},datatype:"json",success:function(result){if(result!=0){var list='<div class="lists"><ul>';$.each(result,(function(id,val){list+='<li val="'+id+'">'+val+"</li>"}));list+="</ul></div>";el.after(list);$(".lists").on("click","li",(function(){var s=$(this);$("#"+el.attr("id")+"_hidden").val(s.attr("val"));$(el).val(s.text());$(".lists").remove()}))}}})}}))}$((function(){$("input.autocomplete").keyup((function(e){var url=base+"/autocomplete/";var tmpData={value:"",filter:""};$("input.autocomplete").keyup((function(e){var el=$(this);$("#"+el.attr("id")+"_hidden").val("");url=el.data("url")||url;tmpData["filter"]=el.data("filter");$(".lists").remove();if(el.val().length>2){tmpData["value"]=el.val();$.ajax({method:"post",url:url,data:{data:tmpData},datatype:"json",success:function(result){if(result!=0){var list='<div class="lists"><ul>';$.each(result,(function(id,val){list+='<li val="'+id+'">'+val+"</li>"}));list+="</ul></div>";el.after(list);$(".lists").on("click","li",(function(){var s=$(this);$("#"+el.attr("id")+"_hidden").val(s.attr("val"));$(el).val(s.text());$(".lists").remove()}))}}})}}))}))}));
var isSubmited=false;var EventValidationEnd=new CustomEvent("formValidationEnd",{detail:{formUrl:null,formData:{},returnData:{},time:new Date},bubbles:true,cancelable:true});function formValidation(){var forms=$("form"),formChanges=[];if(arguments.length>0){var pass=arguments[0];if(!Array.isArray(pass))forms=$([arguments[0]]);else forms=$(arguments[0])}$(window).on("beforeunload",(function(){if(formChanges.length){return"Are you sure you want to leave?"}}));forms.each((function(){var fel=$(this).css("position","relative"),mask=$('<div class="ajax_loading_mask"><div><div class="spinner-border" role="status"><span class="sr-only">Loading...</span></div></div></div>');var validationType=fel.data("validation-type")||"validate";if(validationType=="skip")return true;var action=fel.attr("action")||location.href;$(":submit",fel).click((function(){if($(this).attr("name")&&fel.find(":submit").length>1){fel.find('input[name="'+fel.attr("name")+'_submit_button"]').remove();fel.append($("<input type='hidden'>").attr({name:fel.attr("name")+"[_submit_button]",value:$(this).attr("name")}))}}));fel.find("input, select, textarea").each((function(){$(this).data("init-value",$(this).val())}));if(fel.is("[enable-unsaved-changes-alert]")){fel.change((function(event){var $this=$(event.target),data=$this.data("init-value");if(data!==$this.val()&&$this.parents().filter("th, tr.filter, thead, table[role=grid]").length<4){formChanges[formChanges.length]=$this}}))}$(document).on("submit",fel,(function(el){mask.fadeTo(0,0).appendTo(fel).fadeTo("slow",1);fel.find("input,select,textarea,submit,button").each((function(){if($(this).hasClass("is-invalid"))$(this).removeClass("is-invalid");if($(this).parent().find(".invalid-feedback").length>0)$(this).parent().find(".invalid-feedback")[0].remove()}));var ell=el;var frm=new FormData(fel[0]);frm.append("validationRequest",validationType);if(!isSubmited){isSubmited=true;var xhr=sendQeury(action,frm);xhr.fail((function(jqXHR,textStatus,errorThrown){isSubmited=false}));var hasError=false;xhr.done((function(data,textStatus,jqXHR){if(data["formErrors"]===undefined){setTimeout((function(){isSubmited=false}),3e3)}if(data["formErrors"]!==undefined){isSubmited=false;var errors=data["formErrors"];var focused=false,errorFields=$();for(var field in errors){var filetype=["diskName","path","entityClass","entityId","mimeType"];for(var ft in filetype){if(field.indexOf(filetype[ft])>-1){errors[field]=null;field=field.replace("."+filetype[ft],"][fileName");errors[field]="File must be selected"}}var tdmy=["day","month","year"];for(var dmy in tdmy){var testName=field.substr(field.length-tdmy[dmy].length-1,tdmy[dmy].length);if(testName==tdmy[dmy]){field=field.substr(0,field.length-(tdmy[dmy].length+2))}}var fld=fel.find('[name="'+field+'"]');if(fld.length==0){fld=fel.find('[name="'+field+'[]"]')}if(fld.length==0){fld=$("ul[data-prototype]").filter((function(){return $(this).data("prototype").indexOf(field)!=-1}));fld.parent().addClass("validate")}if(fld.length==0){fld=fel.find('[name="'+field+'[fileName]"]')}console.log("invalid field/s/",field,fld,errors[field]);if(fld.length==1||fld.length>1&&$(fld[0]).attr("id").substr(0,6)=="kform_"&&$(fld[0]).is("select")||fld.length>1&&$(fld[1]).attr("id").substr(0,6)=="kform_"&&$(fld[1]).is("select")){if(fld.length>1){if(fld.length>1&&$(fld[0]).attr("id").substr(0,6)=="kform_"&&$(fld[0]).is("select"))fld=[fld[0]];else if(fld.length>1&&$(fld[1]).attr("id").substr(0,6)=="kform_"&&$(fld[1]).is("select"))fld=[fld[1]];else throw"Error finding proper element to show error!!!"}hasError=true;fld=$(fld[0]);if(!fld.hasClass("is-invalid"))fld.addClass("is-invalid");if(fld.parent().find(".invalid-feedback").length>0){fld.parent().find(".invalid-feedback").html(errors[field])}else{fld.after('<div class="invalid-feedback">'+errors[field]+"</div>")}errorFields=errorFields.add(fld)}else if(fld.length>1){var ferrel=fld.parent().parent().parent();console.log("show error1",errors[field],ferrel);if(ferrel.length>0){var errel=$(ferrel[0]).parent().find(".invalid-feedback");if(errel.length==1){errel=$(errel[0]);errel.html(errors[field]);setTimeout((function(){if(errel.css("display")=="none"){errel.css("display","block")}}),500)}else{$('<div class="invalid-feedback" style="display:block;">'+errors[field]+"</div>").insertAfter(ferrel[0])}errorFields=errorFields.add(fld[0])}else{$('<div class="form-group row  validate"><div class="invalid-feedback">'+errors[field]+"</div></div>").insertBefore(fel.find('[type="submit"]')[0])}}else{var ferrel=fel.find('[type="submit"]').parent().find("div.form-group");console.log("show error2",errors[field],ferrel);if(ferrel.length>0){ferrel.html('<div class="invalid-feedback">'+errors[field]+"</div>")}else{$('<div class="form-group row  validate"><div class="invalid-feedback">'+errors[field]+"</div></div>").insertBefore(fel.find('[type="submit"]')[0])}}}showElement(errorFields.first())}else{for(var i=formChanges.length-1;i>=0;i--){if(!formChanges[i].length||formChanges[i].parents("form:first").is(fel)){formChanges.splice(i,1)}}}if(data["redirectTo"]!==undefined){if(data["windowOpen"]!==undefined){window.open(data["windowOpen"],"_blank");setTimeout((function(){location.href=data["redirectTo"]}),500);setTimeout((function(){$("#dwiframe").attr("src",data["windowOpen"])}),500)}else location.href=data["redirectTo"]}else{var furl=fel.attr("action");if(!furl||furl.length<1)furl=document.location.href;EventValidationEnd["detail"]["formUrl"]=furl;EventValidationEnd["detail"]["returnData"]=data;EventValidationEnd["detail"]["formData"]=fel.serializeArray();fel.get(0).dispatchEvent(EventValidationEnd);mask.fadeTo("slow",0,(function(){mask.detach()}))}}))}if(validationType!="skip"){el.preventDefault();return false}}))}))}$((function(){$('form[readonly][readonly!=""]').find("input, select, textarea, button").attr({disabled:true,readonly:true}).filter("[type=submit], .btn.add, .btn.btn-danger").remove()}));$((function(){$('[type=submit][next][next!=""]').each((function(){var button=$(this),next_string=button.html(),save_string=button.attr("next"),next_class=button.attr("nextClass")||false,form=button.parents("form:first");function findNextToClick(parent){var result=$();$($(".nav-tabs:visible",parent).get().reverse()).each((function(){result=result.length?result:$(".active",this).parent().nextAll(":visible").first()}));return result}function clickCallback(){return findNextToClick(form).find("a").click().trigger("click").length==0}button.click(clickCallback);form.find("li.nav-item, li.nav-item a").click((function(){setTimeout((function(){if(findNextToClick(form).length==0){if(next_class){button.attr("class",next_class)}button.html(save_string).unbind("click",clickCallback)}else{$("body,html").scrollTop($("#k_header").height()-25)}}),250)}))}))}));
/*!
 * jquery-timepick v1.11.15 - A jQuery timepick plugin inspired by Google Calendar. It supports both mouse and keyboard navigation.
 * Copyright (c) 2015 Jon Thornton - http://jonthornton.github.com/jquery-timepick/
 * License: MIT
 */
(function(factory){if(typeof exports==="object"&&exports&&typeof module==="object"&&module&&module.exports===exports){factory(require("jquery"))}else if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else{factory(jQuery)}})((function($){var _ONE_DAY=86400;var _lang={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"};var _DEFAULTS={appendTo:"body",className:null,closeOnWindowScroll:false,disableTextInput:false,disableTimeRanges:[],disableTouchKeyboard:false,durationTime:null,forceRoundTime:false,maxTime:null,minTime:null,noneOption:false,orientation:"l",roundingFunction:function(seconds,settings){if(seconds===null){return null}else if(typeof settings.step!=="number"){return seconds}else{var offset=seconds%(settings.step*60);var start=settings.minTime||0;offset-=start%(settings.step*60);if(offset>=settings.step*30){seconds+=settings.step*60-offset}else{seconds-=offset}return _moduloSeconds(seconds,settings)}},scrollDefault:null,selectOnBlur:false,show2400:false,showDuration:false,showOn:["click","focus"],showOnFocus:true,step:30,stopScrollPropagation:false,timeFormat:"g:ia",typeaheadHighlight:true,useSelect:false,wrapHours:true};var methods={init:function(options){return this.each((function(){var self=$(this);var attributeOptions=[];for(var key in _DEFAULTS){if(self.data(key)){attributeOptions[key]=self.data(key)}}var settings=$.extend({},_DEFAULTS,options,attributeOptions);if(settings.lang){_lang=$.extend(_lang,settings.lang)}settings=_parseSettings(settings);self.data("timepick-settings",settings);self.addClass("ui-timepick-input");if(settings.useSelect){_render(self)}else{self.prop("autocomplete","off");if(settings.showOn){for(var i in settings.showOn){self.on(settings.showOn[i]+".timepick",methods.show)}}self.on("change.timepick",_formatValue);self.on("keydown.timepick",_keydownhandler);self.on("keyup.timepick",_keyuphandler);if(settings.disableTextInput){self.on("keydown.timepick",_disableTextInputHandler)}self.on("cut.timepick",_keyuphandler);self.on("paste.timepick",_keyuphandler);_formatValue.call(self.get(0),null,"initial")}}))},show:function(e){var self=$(this);var settings=self.data("timepick-settings");if(e){e.preventDefault()}if(settings.useSelect){self.data("timepick-list").focus();return}if(_hideKeyboard(self)){self.blur()}var list=self.data("timepick-list");if(self.prop("readonly")){return}if(!list||list.length===0||typeof settings.durationTime==="function"){_render(self);list=self.data("timepick-list")}if(_isVisible(list)){return}self.data("ui-timepick-value",self.val());_setSelected(self,list);methods.hide();list.show();var listOffset={};if(settings.orientation.match(/r/)){listOffset.left=self.offset().left+self.outerWidth()-list.outerWidth()+parseInt(list.css("marginLeft").replace("px",""),10)}else{listOffset.left=self.offset().left+parseInt(list.css("marginLeft").replace("px",""),10)}var verticalOrientation;if(settings.orientation.match(/t/)){verticalOrientation="t"}else if(settings.orientation.match(/b/)){verticalOrientation="b"}else if(self.offset().top+self.outerHeight(true)+list.outerHeight()>$(window).height()+$(window).scrollTop()){verticalOrientation="t"}else{verticalOrientation="b"}if(verticalOrientation=="t"){list.addClass("ui-timepick-positioned-top");listOffset.top=self.offset().top-list.outerHeight()+parseInt(list.css("marginTop").replace("px",""),10)}else{list.removeClass("ui-timepick-positioned-top");listOffset.top=self.offset().top+self.outerHeight()+parseInt(list.css("marginTop").replace("px",""),10)}list.offset(listOffset);var selected=list.find(".ui-timepick-selected");if(!selected.length){var timeInt=_time2int(_getTimeValue(self));if(timeInt!==null){selected=_findRow(self,list,timeInt)}else if(settings.scrollDefault){selected=_findRow(self,list,settings.scrollDefault())}}if(!selected.length||selected.hasClass("ui-timepick-disabled")){selected=list.find("li:not(.ui-timepick-disabled):first")}if(selected&&selected.length){var topOffset=list.scrollTop()+selected.position().top-selected.outerHeight();list.scrollTop(topOffset)}else{list.scrollTop(0)}if(settings.stopScrollPropagation){$(document).on("wheel.ui-timepick",".ui-timepick-wrapper",(function(e){e.preventDefault();var currentScroll=$(this).scrollTop();$(this).scrollTop(currentScroll+e.originalEvent.deltaY)}))}$(document).on("touchstart.ui-timepick mousedown.ui-timepick",_closeHandler);$(window).on("resize.ui-timepick",_closeHandler);if(settings.closeOnWindowScroll){$(document).on("scroll.ui-timepick",_closeHandler)}self.trigger("showtimepick");return this},hide:function(e){var self=$(this);var settings=self.data("timepick-settings");if(settings&&settings.useSelect){self.blur()}$(".ui-timepick-wrapper").each((function(){var list=$(this);if(!_isVisible(list)){return}var self=list.data("timepick-input");var settings=self.data("timepick-settings");if(settings&&settings.selectOnBlur){_selectValue(self)}list.hide();self.trigger("hidetimepick")}));return this},option:function(key,value){if(typeof key=="string"&&typeof value=="undefined"){return $(this).data("timepick-settings")[key]}return this.each((function(){var self=$(this);var settings=self.data("timepick-settings");var list=self.data("timepick-list");if(typeof key=="object"){settings=$.extend(settings,key)}else if(typeof key=="string"){settings[key]=value}settings=_parseSettings(settings);self.data("timepick-settings",settings);_formatValue.call(self.get(0),{type:"change"},"initial");if(list){list.remove();self.data("timepick-list",false)}if(settings.useSelect){_render(self)}}))},getSecondsFromMidnight:function(){return _time2int(_getTimeValue(this))},getTime:function(relative_date){var self=this;var time_string=_getTimeValue(self);if(!time_string){return null}var offset=_time2int(time_string);if(offset===null){return null}if(!relative_date){relative_date=new Date}var time=new Date(relative_date);time.setHours(offset/3600);time.setMinutes(offset%3600/60);time.setSeconds(offset%60);time.setMilliseconds(0);return time},isVisible:function(){var self=this;var list=self.data("timepick-list");return!!(list&&_isVisible(list))},setTime:function(value){var self=this;var settings=self.data("timepick-settings");if(settings.forceRoundTime){var prettyTime=_roundAndFormatTime(_time2int(value),settings)}else{var prettyTime=_int2time(_time2int(value),settings)}if(value&&prettyTime===null&&settings.noneOption){prettyTime=value}_setTimeValue(self,prettyTime,"initial");_formatValue.call(self.get(0),{type:"change"},"initial");if(self.data("timepick-list")){_setSelected(self,self.data("timepick-list"))}return this},remove:function(){var self=this;if(!self.hasClass("ui-timepick-input")){return}var settings=self.data("timepick-settings");self.removeAttr("autocomplete","off");self.removeClass("ui-timepick-input");self.removeData("timepick-settings");self.off(".timepick");if(self.data("timepick-list")){self.data("timepick-list").remove()}if(settings.useSelect){self.show()}self.removeData("timepick-list");return this}};function _isVisible(elem){var el=elem[0];return el.offsetWidth>0&&el.offsetHeight>0}function _parseSettings(settings){if(settings.minTime){settings.minTime=_time2int(settings.minTime)}if(settings.maxTime){settings.maxTime=_time2int(settings.maxTime)}if(settings.durationTime&&typeof settings.durationTime!=="function"){settings.durationTime=_time2int(settings.durationTime)}if(settings.scrollDefault=="now"){settings.scrollDefault=function(){return settings.roundingFunction(_time2int(new Date),settings)}}else if(settings.scrollDefault&&typeof settings.scrollDefault!="function"){var val=settings.scrollDefault;settings.scrollDefault=function(){return settings.roundingFunction(_time2int(val),settings)}}else if(settings.minTime){settings.scrollDefault=function(){return settings.roundingFunction(settings.minTime,settings)}}if($.type(settings.timeFormat)==="string"&&settings.timeFormat.match(/[gh]/)){settings._twelveHourTime=true}if(settings.showOnFocus===false&&settings.showOn.indexOf("focus")!=-1){settings.showOn.splice(settings.showOn.indexOf("focus"),1)}if(settings.disableTimeRanges.length>0){for(var i in settings.disableTimeRanges){settings.disableTimeRanges[i]=[_time2int(settings.disableTimeRanges[i][0]),_time2int(settings.disableTimeRanges[i][1])]}settings.disableTimeRanges=settings.disableTimeRanges.sort((function(a,b){return a[0]-b[0]}));for(var i=settings.disableTimeRanges.length-1;i>0;i--){if(settings.disableTimeRanges[i][0]<=settings.disableTimeRanges[i-1][1]){settings.disableTimeRanges[i-1]=[Math.min(settings.disableTimeRanges[i][0],settings.disableTimeRanges[i-1][0]),Math.max(settings.disableTimeRanges[i][1],settings.disableTimeRanges[i-1][1])];settings.disableTimeRanges.splice(i,1)}}}return settings}function _render(self){var settings=self.data("timepick-settings");var list=self.data("timepick-list");if(list&&list.length){list.remove();self.data("timepick-list",false)}if(settings.useSelect){list=$("<select />",{class:"ui-timepick-select"});if(self.attr("name")){list.attr("name","ui-timepick-"+self.attr("name"))}var wrapped_list=list}else{list=$("<ul />",{class:"ui-timepick-list"});var wrapped_list=$("<div />",{class:"ui-timepick-wrapper",tabindex:-1});wrapped_list.css({display:"none",position:"absolute"}).append(list)}if(settings.noneOption){if(settings.noneOption===true){settings.noneOption=settings.useSelect?"Time...":"None"}if($.isArray(settings.noneOption)){for(var i in settings.noneOption){if(parseInt(i,10)==i){var noneElement=_generateNoneElement(settings.noneOption[i],settings.useSelect);list.append(noneElement)}}}else{var noneElement=_generateNoneElement(settings.noneOption,settings.useSelect);list.append(noneElement)}}if(settings.className){wrapped_list.addClass(settings.className)}if((settings.minTime!==null||settings.durationTime!==null)&&settings.showDuration){var stepval=typeof settings.step=="function"?"function":settings.step;wrapped_list.addClass("ui-timepick-with-duration");wrapped_list.addClass("ui-timepick-step-"+settings.step)}var durStart=settings.minTime;if(typeof settings.durationTime==="function"){durStart=_time2int(settings.durationTime())}else if(settings.durationTime!==null){durStart=settings.durationTime}var start=settings.minTime!==null?settings.minTime:0;var end=settings.maxTime!==null?settings.maxTime:start+_ONE_DAY-1;if(end<start){end+=_ONE_DAY}if(end===_ONE_DAY-1&&$.type(settings.timeFormat)==="string"&&settings.show2400){end=_ONE_DAY}var dr=settings.disableTimeRanges;var drCur=0;var drLen=dr.length;var stepFunc=settings.step;if(typeof stepFunc!="function"){stepFunc=function(){return settings.step}}for(var i=start,j=0;i<=end;j++,i+=stepFunc(j)*60){var timeInt=i;var timeString=_int2time(timeInt,settings);if(settings.useSelect){var row=$("<option />",{value:timeString});row.text(timeString)}else{var row=$("<li />");row.addClass(timeInt%_ONE_DAY<_ONE_DAY/2?"ui-timepick-am":"ui-timepick-pm");row.data("time",_moduloSeconds(timeInt,settings));row.text(timeString)}if((settings.minTime!==null||settings.durationTime!==null)&&settings.showDuration){var durationString=_int2duration(i-durStart,settings.step);if(settings.useSelect){row.text(row.text()+" ("+durationString+")")}else{var duration=$("<span />",{class:"ui-timepick-duration"});duration.text(" ("+durationString+")");row.append(duration)}}if(drCur<drLen){if(timeInt>=dr[drCur][1]){drCur+=1}if(dr[drCur]&&timeInt>=dr[drCur][0]&&timeInt<dr[drCur][1]){if(settings.useSelect){row.prop("disabled",true)}else{row.addClass("ui-timepick-disabled")}}}list.append(row)}wrapped_list.data("timepick-input",self);self.data("timepick-list",wrapped_list);if(settings.useSelect){if(self.val()){list.val(_roundAndFormatTime(_time2int(self.val()),settings))}list.on("focus",(function(){$(this).data("timepick-input").trigger("showtimepick")}));list.on("blur",(function(){$(this).data("timepick-input").trigger("hidetimepick")}));list.on("change",(function(){_setTimeValue(self,$(this).val(),"select")}));_setTimeValue(self,list.val(),"initial");self.hide().after(list)}else{var appendTo=settings.appendTo;if(typeof appendTo==="string"){appendTo=$(appendTo)}else if(typeof appendTo==="function"){appendTo=appendTo(self)}appendTo.append(wrapped_list);_setSelected(self,list);list.on("mousedown click","li",(function(e){self.off("focus.timepick");self.on("focus.timepick-ie-hack",(function(){self.off("focus.timepick-ie-hack");self.on("focus.timepick",methods.show)}));if(!_hideKeyboard(self)){self[0].focus()}list.find("li").removeClass("ui-timepick-selected");$(this).addClass("ui-timepick-selected");if(_selectValue(self)){self.trigger("hidetimepick");list.on("mouseup.timepick click.timepick","li",(function(e){list.off("mouseup.timepick click.timepick");wrapped_list.hide()}))}}))}}function _generateNoneElement(optionValue,useSelect){var label,className,value;if(typeof optionValue=="object"){label=optionValue.label;className=optionValue.className;value=optionValue.value}else if(typeof optionValue=="string"){label=optionValue;value=""}else{$.error("Invalid noneOption value")}if(useSelect){return $("<option />",{value:value,class:className,text:label})}else{return $("<li />",{class:className,text:label}).data("time",String(value))}}function _roundAndFormatTime(seconds,settings){seconds=settings.roundingFunction(seconds,settings);if(seconds!==null){return _int2time(seconds,settings)}}function _closeHandler(e){if(e.target==window){return}var target=$(e.target);if(target.closest(".ui-timepick-input").length||target.closest(".ui-timepick-wrapper").length){return}methods.hide();$(document).unbind(".ui-timepick");$(window).unbind(".ui-timepick")}function _hideKeyboard(self){var settings=self.data("timepick-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&settings.disableTouchKeyboard}function _findRow(self,list,value){if(!value&&value!==0){return false}var settings=self.data("timepick-settings");var out=false;var value=settings.roundingFunction(value,settings);list.find("li").each((function(i,obj){var jObj=$(obj);if(typeof jObj.data("time")!="number"){return}if(jObj.data("time")==value){out=jObj;return false}}));return out}function _setSelected(self,list){list.find("li").removeClass("ui-timepick-selected");var settings=self.data("timepick-settings");var timeValue=_time2int(_getTimeValue(self),settings);if(timeValue===null){return}var selected=_findRow(self,list,timeValue);if(selected){var topDelta=selected.offset().top-list.offset().top;if(topDelta+selected.outerHeight()>list.outerHeight()||topDelta<0){list.scrollTop(list.scrollTop()+selected.position().top-selected.outerHeight())}if(settings.forceRoundTime||selected.data("time")===timeValue){selected.addClass("ui-timepick-selected")}}}function _formatValue(e,origin){if(origin=="timepick"){return}var self=$(this);if(this.value===""){_setTimeValue(self,null,origin);return}if(self.is(":focus")&&(!e||e.type!="change")){return}var settings=self.data("timepick-settings");var seconds=_time2int(this.value,settings);if(seconds===null){self.trigger("timeFormatError");return}var rangeError=false;if(settings.minTime!==null&&settings.maxTime!==null&&(seconds<settings.minTime||seconds>settings.maxTime)){rangeError=true}$.each(settings.disableTimeRanges,(function(){if(seconds>=this[0]&&seconds<this[1]){rangeError=true;return false}}));if(settings.forceRoundTime){var roundSeconds=settings.roundingFunction(seconds,settings);if(roundSeconds!=seconds){seconds=roundSeconds;origin=null}}var prettyTime=_int2time(seconds,settings);if(rangeError){if(_setTimeValue(self,prettyTime,"error")||e&&e.type=="change"){self.trigger("timeRangeError")}}else{_setTimeValue(self,prettyTime,origin)}}function _getTimeValue(self){if(self.is("input")){return self.val()}else{return self.data("ui-timepick-value")}}function _setTimeValue(self,value,source){if(self.is("input")){self.val(value);var settings=self.data("timepick-settings");if(settings.useSelect&&source!="select"&&self.data("timepick-list")){self.data("timepick-list").val(_roundAndFormatTime(_time2int(value),settings))}}if(self.data("ui-timepick-value")!=value){self.data("ui-timepick-value",value);if(source=="select"){self.trigger("selectTime").trigger("changeTime").trigger("change","timepick")}else if(["error","initial"].indexOf(source)==-1){self.trigger("changeTime")}return true}else{if(["error","initial"].indexOf(source)==-1){self.trigger("selectTime")}return false}}function _disableTextInputHandler(e){switch(e.keyCode){case 13:case 9:return;default:e.preventDefault()}}function _keydownhandler(e){var self=$(this);var list=self.data("timepick-list");if(!list||!_isVisible(list)){if(e.keyCode==40){methods.show.call(self.get(0));list=self.data("timepick-list");if(!_hideKeyboard(self)){self.focus()}}else{return true}}switch(e.keyCode){case 13:if(_selectValue(self)){_formatValue.call(self.get(0),{type:"change"});methods.hide.apply(this)}e.preventDefault();return false;case 38:var selected=list.find(".ui-timepick-selected");if(!selected.length){list.find("li").each((function(i,obj){if($(obj).position().top>0){selected=$(obj);return false}}));selected.addClass("ui-timepick-selected")}else if(!selected.is(":first-child")){selected.removeClass("ui-timepick-selected");selected.prev().addClass("ui-timepick-selected");if(selected.prev().position().top<selected.outerHeight()){list.scrollTop(list.scrollTop()-selected.outerHeight())}}return false;case 40:selected=list.find(".ui-timepick-selected");if(selected.length===0){list.find("li").each((function(i,obj){if($(obj).position().top>0){selected=$(obj);return false}}));selected.addClass("ui-timepick-selected")}else if(!selected.is(":last-child")){selected.removeClass("ui-timepick-selected");selected.next().addClass("ui-timepick-selected");if(selected.next().position().top+2*selected.outerHeight()>list.outerHeight()){list.scrollTop(list.scrollTop()+selected.outerHeight())}}return false;case 27:list.find("li").removeClass("ui-timepick-selected");methods.hide();break;case 9:methods.hide();break;default:return true}}function _keyuphandler(e){var self=$(this);var list=self.data("timepick-list");var settings=self.data("timepick-settings");if(!list||!_isVisible(list)||settings.disableTextInput){return true}if(e.type==="paste"||e.type==="cut"){setTimeout((function(){if(settings.typeaheadHighlight){_setSelected(self,list)}else{list.hide()}}),0);return}switch(e.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:if(settings.typeaheadHighlight){_setSelected(self,list)}else{list.hide()}break}}function _selectValue(self){var settings=self.data("timepick-settings");var list=self.data("timepick-list");var timeValue=null;var cursor=list.find(".ui-timepick-selected");if(cursor.hasClass("ui-timepick-disabled")){return false}if(cursor.length){timeValue=cursor.data("time")}if(timeValue!==null){if(typeof timeValue!="string"){timeValue=_int2time(timeValue,settings)}_setTimeValue(self,timeValue,"select")}return true}function _int2duration(seconds,step){seconds=Math.abs(seconds);var minutes=Math.round(seconds/60),duration=[],hours,mins;if(minutes<60){duration=[minutes,_lang.mins]}else{hours=Math.floor(minutes/60);mins=minutes%60;if(step==30&&mins==30){hours+=_lang.decimal+5}duration.push(hours);duration.push(hours==1?_lang.hr:_lang.hrs);if(step!=30&&mins){duration.push(mins);duration.push(_lang.mins)}}return duration.join(" ")}function _int2time(timeInt,settings){if(typeof timeInt!="number"){return null}var seconds=parseInt(timeInt%60),minutes=parseInt(timeInt/60%60),hours=parseInt(timeInt/(60*60)%24);var time=new Date(1970,0,2,hours,minutes,seconds,0);if(isNaN(time.getTime())){return null}if($.type(settings.timeFormat)==="function"){return settings.timeFormat(time)}var output="";var hour,code;for(var i=0;i<settings.timeFormat.length;i++){code=settings.timeFormat.charAt(i);switch(code){case"a":output+=time.getHours()>11?_lang.pm:_lang.am;break;case"A":output+=time.getHours()>11?_lang.PM:_lang.AM;break;case"g":hour=time.getHours()%12;output+=hour===0?"12":hour;break;case"G":hour=time.getHours();if(timeInt===_ONE_DAY)hour=settings.show2400?24:0;output+=hour;break;case"h":hour=time.getHours()%12;if(hour!==0&&hour<10){hour="0"+hour}output+=hour===0?"12":hour;break;case"H":hour=time.getHours();if(timeInt===_ONE_DAY)hour=settings.show2400?24:0;output+=hour>9?hour:"0"+hour;break;case"i":var minutes=time.getMinutes();output+=minutes>9?minutes:"0"+minutes;break;case"s":seconds=time.getSeconds();output+=seconds>9?seconds:"0"+seconds;break;case"\\":i++;output+=settings.timeFormat.charAt(i);break;default:output+=code}}return output}function _time2int(timeString,settings){if(timeString===""||timeString===null)return null;if(typeof timeString=="object"){return timeString.getHours()*3600+timeString.getMinutes()*60+timeString.getSeconds()}if(typeof timeString!="string"){return timeString}timeString=timeString.toLowerCase().replace(/[\s\.]/g,"");if(timeString.slice(-1)=="a"||timeString.slice(-1)=="p"){timeString+="m"}var ampmRegex="("+_lang.am.replace(".","")+"|"+_lang.pm.replace(".","")+"|"+_lang.AM.replace(".","")+"|"+_lang.PM.replace(".","")+")?";var pattern=new RegExp("^"+ampmRegex+"([0-9]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?"+ampmRegex+"$");var time=timeString.match(pattern);if(!time){return null}var hour=parseInt(time[2]*1,10);var ampm=time[1]||time[5];var hours=hour;var minutes=time[3]*1||0;var seconds=time[4]*1||0;if(hour<=12&&ampm){var isPm=ampm==_lang.pm||ampm==_lang.PM;if(hour==12){hours=isPm?12:0}else{hours=hour+(isPm?12:0)}}else if(settings){var t=hour*3600+minutes*60+seconds;if(t>=_ONE_DAY+(settings.show2400?1:0)){if(settings.wrapHours===false){return null}hours=hour%24}}var timeInt=hours*3600+minutes*60+seconds;if(hour<12&&!ampm&&settings&&settings._twelveHourTime&&settings.scrollDefault){var delta=timeInt-settings.scrollDefault();if(delta<0&&delta>=_ONE_DAY/-2){timeInt=(timeInt+_ONE_DAY/2)%_ONE_DAY}}return timeInt}function _pad2(n){return("0"+n).slice(-2)}function _moduloSeconds(seconds,settings){if(seconds==_ONE_DAY&&settings.show2400){return seconds}return seconds%_ONE_DAY}$.fn.timepick=function(method){if(!this.length)return this;if(methods[method]){if(!this.hasClass("ui-timepick-input")){return this}return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.timepick")}}}));
function deleteConf(e){var t="\n";$(e).closest("tr").find("td").not(":last").each((function(k,v){t+=$(v).text()+"\n"}));var del=confirm("Are you sure you want to delete?"+t);return del}function sendQeury(url,sendData){var defProps={dataType:"JSON",type:"POST"};var props={};if(arguments.length>2){console.log(arguments);props=arguments[2];if(props["type"]!==undefined){defProps["type"]=props["type"]}if(props["dataType"]!==undefined){defProps["dataType"]=props["dataType"]}}if(url.substr(0,1)!="/"&&url.substr(0,10).indexOf("//")<0)url=base+url;var hasError=false;if(sendData===undefined){var data={}}else{var data=sendData instanceof FormData?sendData:$.param(sendData)}var contentType=sendData instanceof FormData?false:undefined;var showLogError=function(data,jqXHR,textStatus,messageBody){hasError=true;var doNotLogMe=false;var retrieved={DataReported:{URL:url,status:textStatus,message:messageBody,time:(new Date).toTimeString(),readyState:jqXHR.readyState,serverErorCode:jqXHR.status,profile:profileId},fdata:{}};if(data instanceof FormData){data=data.entries();var obj=data.next();while(undefined!==obj.value){retrieved["fdata"][obj.value[0]]=obj.value[1];obj=data.next()}}else{retrieved["fdata"]=data}var errorType="UNKOWN. Nothing matched.";if(jqXHR.readyState==0)errorType="NETWORK ERROR! No connection to server!";if(jqXHR.readyState==4&&jqXHR.status<300)errorType="Script servrer side error";if(jqXHR.readyState==4&&jqXHR.status>399&&jqXHR.status<500)errorType="Server error 4xx";if(jqXHR.readyState==4&&jqXHR.status>499)errorType="Server error 5xx";if(jqXHR.readyState==4&&jqXHR.status==500)errorType="<b>Script server error! Looks like a bug. Report sent.</b>";var body="<b>Server error code:</b> "+status+"<br>\n"+"<b>URL:</b> "+url+"<br>\n"+"<b>Status:</b> "+textStatus+"<br>\n"+"<b>Message:</b> "+messageBody+"<br>\n"+"<b>Report Data length:</b> "+Object.keys(retrieved["fdata"]).length+"<br>\n"+"<b>Error type:</b>"+errorType+"<br>\n";if(retrieved["fdata"]["_no_fail_send"]!==undefined&&retrieved["fdata"]["_no_fail_send"]=="true"){doNotLogMe=true}if(jqXHR.readyState==0||jqXHR.readyState==4&&jqXHR.status!=500&&jqXHR.status!=200){doNotLogMe=true;console.log("do not log",jqXHR.readyState,jqXHR.status)}if(doNotLogMe==false&&env!="dev"){$('#_bugs_dialog form [name="bugs_form[type]"] option').each((function(){var sl=false;if($(this).text().trim()=="Bug"){sl=true}$(this).attr("selected",sl)}));$("#bugs_form_description").val("Report from AJAX fail code.");$("#bugs_form_pageForms").val(JSON.stringify(retrieved,null,4));$('form[name="bugs_form"]').append('<input name="_no_fail_send" value="true"/>');setTimeout((function(){console.log("submit bug form");$('form[name="bugs_form"]').submit()}),300);setTimeout((function(){$('form[name="bugs_form"] input[name="_no_fail_send"]').remove();$("#bugs_form_description").val("");$("#bugs_form_pageForms").val("")}),2e3)}sysMsg.show({title:"Error performing ajax query",body:body});var mask=$(".ajax_loading_mask");if(mask){mask.fadeTo("slow",0,(function(){mask.detach()}))}};var xhr=$.ajax({url:url,type:defProps["type"],dataType:defProps["dataType"],data:data,processData:false,contentType:contentType}).fail((function(jqXHR,textStatus,errorThrown){showLogError(data,jqXHR,textStatus,errorThrown)})).always((function(rdata,textStatus,jqXHR){if(rdata instanceof Object==true){if(rdata["error"]!==undefined){showLogError(data,jqXHR,textStatus,rdata["error"])}}})).done((function(data){if(data instanceof Object==true){if(data["formErrors"]!==undefined&&sendData["data"]!==undefined&&sendData["data"]["validateCustomAjax"]!==undefined&&true===sendData["data"]["validateCustomAjax"]){var errorsStr="";for(var fe in data["formErrors"]){errorsStr+="<b>"+fe+":</b> <i>"+data.formErrors[fe]+"</i><br>"}sysMsg.show({title:"Form validation error",body:"<b>Errors:</b> <hr>"+errorsStr});var mask=$(".ajax_loading_mask");if(mask){mask.fadeTo("slow",0,(function(){mask.detach()}))}}}}));return xhr}function msToDate(ms,format){var date=new Date(ms);var d=date.getDate()<10?"0"+date.getDate():date.getDate();var m=date.getMonth()<9?"0"+parseInt(date.getMonth()+1):parseInt(date.getMonth()+1);var y=date.getFullYear();var h=date.getHours()<10?"0"+date.getHours():date.getHours();var min=date.getMinutes()<10?"0"+date.getMinutes():date.getMinutes();var dateString=null;switch(format){case"dd.mm.yyyy HH:MM":dateString=d+"."+m+"."+y+" "+h+":"+min;break;case"dd-mm-yyyy HH:MM":dateString=d+"-"+m+"-"+y+" "+h+":"+min;break;case"dd.mm.yyyy":dateString=d+"."+m+"."+y;break;case"dd-mm-yyyy":dateString=d+"-"+m+"-"+y;break;default:dateString=y+"-"+m+"-"+d+" "+h+":"+min}return dateString}function timeToMs(timetoms){timetoms=timetoms.split(":");htoms=parseInt(timetoms[0])*60*60*1e3;mtoms=parseInt(timetoms[1])*60*1e3;result_ms=parseInt(htoms+mtoms);return result_ms}function isScrolledIntoView(elem){var docViewTop=$(window).scrollTop();var docViewBottom=docViewTop+$(window).height();var elemTop=$(elem).offset().top;var elemBottom=elemTop+$(elem).height();return elemBottom<=docViewBottom&&elemTop>=docViewTop}var sysMsg;var blockLdr;(function($){$(document).ready((function(){sysMsg=new sysMessage;blockLdr=new BlockLoader;if(typeof gridReorder==="function")gridReorder();if(typeof formValidation==="function")formValidation();$('[data-toggle="tooltip"]').tooltip();$('[data-toggle="popover"]').popover();$("textarea.autoresize").each((function(){autosize($(this));autosize.update($(this))}))}))})(jQuery);function showElement(element){element=element.jquery?element:$(element);if(element.length){if(element.is('[type="hidden"]')){if(element.parent().find("input, select, textarea").filter(":visible:first").length>0){element=element.parent().find("input, select, textarea").filter(":visible:first")}else{element=element.parent()}}if(element.length){element.click().parents(".tab-pane").each((function(){$('a[href="#'+this.id+'"]').click()}));setTimeout((function(){$("body,html").scrollTop(element.focus().offset().top-$("#k_header").height()-200)}),250);return true}}return false}(function($){$(document).ready((function(){if(window.location.hash&&window.location.hash.indexOf("openpath=")<0){showElement(window.location.hash);showElement('a[role=tab][href="'+(""+window.location.hash).replace("#","#tabs_")+'"]')}$("div.error").parent().find("input, select, textarea").first().each((function(){showElement(this)}));$(".touppercase").blur((function(){if(this.value){this.value=this.value.toUpperCase()}}));$(document).on("mouseover",".dynamic li .btn-delete",(function(){$(this).parent().css("background","#f7eaea")}));$(document).on("mouseout",".dynamic li .btn-delete",(function(){$(this).parent().css("background","")}));var picker=$("#dashboard_daterangepicker");var start=moment();var end=moment();function cb(start,end,label){var title="";var range="";if(end-start<100||label=="Today"){title="Today:";range=start.format(i18n.date_format.toUpperCase())}else if(label=="Yesterday"){title="Yesterday:";range=start.format(i18n.date_format.toUpperCase())}else{range=start.format(i18n.date_format.toUpperCase())+" - "+end.format(i18n.date_format.toUpperCase())}picker.find("#dashboard_daterangepicker_date").html(range);picker.find("#dashboard_daterangepicker_title").html(title)}picker.daterangepicker({direction:KUtil.isRTL(),startDate:start,endDate:end,opens:"left",applyClass:"btn btn-sm btn-primary",cancelClass:"btn btn-sm btn-secondary",locale:{format:i18n.date_format.toUpperCase()},ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}},cb);cb(start,end,"")}))})(jQuery);$("form").each((function(){var $that=$(this);$that.on("change",'select[name*="units"]',(function(){$('input[type=hidden][data-units-field="'+(this.name||"").replace(/^.+\[([^\]]+)\]$/,"$1")+'"]',$that).val($(this).val())}));$that.find(".btn.add").click((function(){setTimeout((function(){$('select[name*="units"]',$that).change()}),250)}))}));function convert(value,from,to){if(!value||typeof from=="undefined"||typeof to=="undefined"){return value}var result=null;var conversions={mm:{mm:1,m:1e3,km:1e6,in:25.4000000259,ft:304.799999537,sm:1609347.2187,nm:1852e3},m:{mm:.001,m:1,km:1e3,in:.0254000000259,ft:.304799999537,sm:1609.3472187,nm:1852},km:{mm:1e-6,m:.001,km:1,in:254000000259e-16,ft:.000304799999537,sm:1.6093472187,nm:1.852},in:{mm:.0393700787,m:39.3700787,km:39370.0787,in:1,ft:.0833333333,sm:63360,nm:72913.3848048},ft:{mm:.0032808399,m:3.2808399,km:3280.8399,in:12,ft:1,sm:5280,nm:6076.11562192},sm:{mm:6.21369949493e-7,m:.000621369949493,km:.621369949493,in:157828282828e-16,ft:.000189393939394,sm:1,nm:1.15077944789},nm:{mm:5.39956803456e-7,m:.000539956803456,km:.539956803456,in:13714903e-12,ft:.00016457883,sm:.868976242,nm:1},l:{l:1,m3:1e3,"US gal":3.78541178913,"UK gal":4.54609188687,qt:.946352945492},m3:{l:.001,m3:1,"US gal":.00378541178913,"UK gal":.00454609188687,qt:.000946352945492},"US gal":{l:.264172052,m3:264.172052,"US gal":1,"UK gal":1.20095042256,qt:.25},"UK gal":{l:.219969157,m3:219.969157,"US gal":.83267384,"UK gal":1,qt:.20816846001},qt:{l:1.05668821,m3:1056.68821,"US gal":4,"UK gal":4.80380169,qt:1},kg:{kg:1,ton:1e3,lb:.45359237038},ton:{kg:.001,ton:1,lb:.00045359237038},lb:{kg:2.20462262,ton:2204.62262,lb:1},Pa:{Pa:1,hPa:100,inHg:3386,mmHg:133.322368368},hPa:{Pa:.01,hPa:1,inHg:33.86,mmHg:1.33322368368},inHg:{Pa:.000295333727,hPa:.0295333727,inHg:1,mmHg:.039374592},mmHg:{Pa:.00750061683,hPa:.750061683,inHg:25.3970886,mmHg:1},sec:{sec:1,min:60,hr:3600},min:{sec:.01666666666667,min:1,hr:60},hr:{sec:.000277777777778,min:.0166666666666,hr:1},"m/s":{"m/s":1,"km/h":.277777778,mph:.44704,"ft/m":3.2808399,"ft/s":.3048,kt:.514444444},"km/h":{"m/s":3.6,"km/h":1,mph:1.609344,"ft/m":.018288,"ft/s":1.09728,kt:1.852},mph:{"m/s":2.23693629,"km/h":.621371192,mph:1,"ft/m":.0113636364,"ft/s":.681818182,kt:1.15077945},"ft/m":{"m/s":196.850394,"km/h":54.6806649,mph:88,"ft/m":1,"ft/s":60,kt:101.268591},"ft/s":{"m/s":3.2808399,"km/h":.911344415,mph:1.46666667,"ft/m":.0166666667,"ft/s":1,kt:1.68780986},kt:{"m/s":1.94384449,"km/h":.539956803,mph:2.23693629,"ft/m":.0113636364,"ft/s":.681818182,kt:1},"l/h":{"l/h":1,"US gal/h":3.78541178},"US gal/h":{"l/h":.264172052,"US gal/h":1}};if(typeof conversions[to]!=="undefined"&&typeof conversions[to][from]!=="undefined"){result=value*conversions[to][from]}return result}
$((function(){$("a[data-delete-link]").on("click",(function(){var link=$(this).data("delete-link");var id=$(this).data("id");var thatEl=$(this);var fileDisplay=$(this).parent().parent();var fileUpload=$(this).parent().parent().parent().find("div.file-upload-field");if(link.indexOf("delete/")>-1&&parseInt(id)>0&&fileDisplay&&fileUpload){if(confirm("Are you sure you want to delete "+$(this).data("file-name"))){sendQeury(link).done((function(result){if("success"in result&&"deleted"in result){if(result["deleted"]==id){var el=thatEl;var prev=null;var delLi=null;var cnt=0;while(cnt<15){prev=el;el=el.parent();console.log("del el",el,prev,el.is("ul"),el.attr("class"));if(el.is("ul")&&el.attr("class").indexOf("dynamic")>-1){delLi=prev;break}cnt++}fileDisplay.remove();fileDisplay.closest("li").remove();fileUpload.show();if(delLi!=null)delLi.remove()}}}))}}}))}));